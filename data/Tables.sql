CREATE DATABASE CAR_GARAGE_MANAGEMENT
GO 
USE CAR_GARAGE_MANAGEMENT
GO
 
----- NOTE: STATUS: DELETED OR EXISTS
-----CREATE TABLE 

CREATE TABLE CAR_GARA (
	ID_GARA CHAR(10) PRIMARY KEY,
	ADDRESS_GARA NVARCHAR(100) NOT NULL,
	PHONE_NUMBER_GARA CHAR(15) NOT NULL,
	STATUS_GARA BIT NOT NULL
)

CREATE TABLE STAFF_POSITION (
	ID_POS CHAR(10) PRIMARY KEY,
	NAME_POS NVARCHAR(50) NOT NULL,
	ID_GARA CHAR(10) NOT NULL,
)

CREATE TABLE STAFFS (
	ID_STAFF CHAR(10) PRIMARY KEY,
	NAME_STAFF NVARCHAR(100) NOT NULL,
	BIRTHDAY_STAFF SMALLDATETIME NOT NULL,
	ADDRESS_STAFF NVARCHAR(100) NOT NULL,
	EMAIL_STAFF VARCHAR(50) NOT NULL,
	PHONE_NUMBER_STAFF CHAR(15) NOT NULL,
	SALARY MONEY NOT NULL,
	ID_POSITION CHAR(10) NOT NULL,
	ID_GARA CHAR(10) NOT NULL,
	STATUS_STAFF BIT NOT NULL
)

CREATE TABLE ACCOUNTS (
	ID_ACC CHAR(10) PRIMARY KEY,
	USERNAME VARCHAR(50) NOT NULL,
	PASSWORD VARCHAR(50) NOT NULL,
	ID_STAFF CHAR(10) NOT NULL,
	ACC_AUTHORIZATION BIT NOT NULL,
	STATUS_ACCOUNT BIT NOT NULL,
)

CREATE TABLE CUSTOMERS (
	ID_CUS CHAR(10) PRIMARY KEY,
	NAME_CUS NVARCHAR(100) NOT NULL,
	PHONE_NUMBER_CUS CHAR(15) NOT NULL,
	ADDRESS_CUS NVARCHAR(100) NOT NULL,
	DEBT MONEY DEFAULT 0,
	STATUS_CUS BIT NOT NULL,
)

CREATE TABLE CAR_BRANDS (
	ID_BRAND CHAR(10) PRIMARY KEY,
	NAME_BRAND NVARCHAR(100) NOT NULL,
	ID_GARA CHAR(10),
	STATUS_BRAND BIT NOT NULL,
)

CREATE TABLE RECEPTION_FORMS (
	ID_REC CHAR(10) PRIMARY KEY,
	ID_CUS CHAR(10)  NOT NULL,
	ID_BRAND CHAR(10) NOT NULL,
	ID_GARA CHAR(10) NOT NULL,
	NUMBER_PLATES VARCHAR(15) NOT NULL,
	RECEPTION_DATE SMALLDATETIME NOT NULL,
	STATUS_REC BIT
)

--- COM means Component
----PRICE column in CAR_COMPONENTS is used to store CURRENT PRICE
----PRICE column in GRN_Details is used to store PRICE for each import
CREATE TABLE CAR_COMPONENTS (
	ID_COM CHAR(10) PRIMARY KEY,
	NAME_COM NVARCHAR(100) NOT NULL,
	CUR_PRICE MONEY NOT NULL,
	ID_GARA CHAR(10),
	STATUS_COM BIT NOT NULL
)

CREATE TABLE WAGE_COMPONENT (
	WAGE_ORDINAL_NUM INT IDENTITY PRIMARY KEY,
	ID_COM CHAR(10) NOT NULL,
	WAGE MONEY NOT NULL,
	STATUS_WAGE_COM BIT NOT NULL
)

-----SUPPLIER is equal to PROVIDER
---- GRN means Good Received Note

CREATE TABLE GOOD_RECEIVED_NOTES (
	LOTNUMBER CHAR(10) PRIMARY KEY,
	SUPPLIER NVARCHAR(100) NOT NULL,
	ID_GARA CHAR(10) NOT NULL,
	IMPORT_TIME SMALLDATETIME NOT NULL,
	--Confirmer means the person who was responsible 
	--for signing the goods received note
	CONFIRMER CHAR(10) NOT NULL, --STAFF
	--DATA_ENTRY_STAFF is responsible for entering data to the system
	DATA_ENTRY_STAFF CHAR(10) NOT NULL, --USER
	TOTAL_PAYMENT_GRN MONEY,
	STATUS_GRN BIT NOT NULL,
)
	
CREATE TABLE GRN_DETAILS(
	GRN_ORDINAL_NUM INT IDENTITY PRIMARY KEY,
	LOTNUMBER CHAR(10) NOT NULL,
	ID_COM CHAR(10) NOT NULL,
	COM_PRICE MONEY NOT NULL,
	COM_QUANTITY INT NOT NULL,
	GRN_TOTAL_PAYMENT MONEY,
	STATUS_GRN BIT NOT NULL
)

----- Rule of the number of cars that should be received each day

CREATE TABLE GARA_QUANTITY_RULES(
	ID_RULE INT IDENTITY PRIMARY KEY,
	ID_GARA CHAR(10) NOT NULL,
	RULE_DATE SMALLDATETIME NOT NULL unique ,
	MAX_QUANTITY INT NOT NULL,
)

CREATE TABLE REPAIR_PAYMENT_BILL (
	ID_BILL CHAR(10) PRIMARY KEY,
	ID_REC CHAR(10) NOT NULL,
	COMPLETION_DATE SMALLDATETIME NOT NULL,
	TOTAL_PAYMENT MONEY,
	STATUS_BILL BIT NOT NULL
)

CREATE TABLE REPAIR_PAYMENT_DETAILS (
	RPD_ORDINAL_NUM INT IDENTITY PRIMARY KEY,
	ID_BILL CHAR(10) NOT NULL,
	ID_COM CHAR(10) NOT NULL,
	REPAIR_DESCRIPTION NVARCHAR(100) NOT NULL,
	COM_QUANTITY INT NOT NULL,
	TOTAL_PRICE MONEY,
	STATUS_RPD BIT NOT NULL
)

---- Cost container two parts: Cost for car_components 
---- and cost for other_costs (water, electric, salary)

CREATE TABLE OTHER_COSTS (
	ID_COST CHAR(10) PRIMARY KEY,
	ID_GARA CHAR(10) NOT NULL,
	NAME_COST NVARCHAR(100) NOT NULL,
	PRICE MONEY NOT NULL,
	COST_SUPPLIER NVARCHAR(100) NOT NULL,
	STATUS_COST BIT NOT NULL,
)

CREATE TABLE INVENTORY_MANAGEMENT(
	IM_ORDINAL_NUM INT IDENTITY PRIMARY KEY,
	ID_GARA CHAR(10) NOT NULL,
	ID_COM CHAR(10) NOT NULL,
	COM_QUANTITY INT NOT NULL
)

CREATE TABLE  BEGINING_INVENTORY (
	BI_ORDINAL_NUM INT IDENTITY PRIMARY KEY,
	ID_COM CHAR(10) NOT NULL,
	ID_GARA CHAR(10) NOT NULL,
	RENDERING_TIME_BI SMALLDATETIME NOT NULL,
	COM_QUANTITY INT NOT NULL,
	TOTAL_PRICE_BI MONEY,
)

CREATE TABLE ENDING_INVENTORY (
	EI_ORDINAL_NUM INT IDENTITY PRIMARY KEY,
	ID_COM CHAR(10) NOT NULL,
	ID_GARA CHAR(10) NOT NULL,
	RENDERING_TIME_EI SMALLDATETIME NOT NULL,
	COM_QUANTITY INT NOT NULL,
	TOTAL_PRICE MONEY,
)

CREATE TABLE INCURRED_COSTS (
	CO_ORDINAL_NUM INT IDENTITY PRIMARY KEY,
	ID_COM CHAR(10),
	ID_GARA CHAR(10) NOT NULL,
	INCURRED_COSTS_DATE SMALLDATETIME NOT NULL,
	STATUS_DESCRIPTION NVARCHAr(100) NOT NULL,
	COM_QUANTITY INT,
	INCURRED_COSTS_TTPRICE MONEY,
	STATUS_IC BIT NOT NULL
)

CREATE TABLE REVENUE (
	ID_REVENUE_REPORT CHAR(10) PRIMARY KEY,
	ID_GARA CHAR(10) NOT NULL,
	RENDERING_TIME_REVENUE SMALLDATETIME NOT NULL,
	ID_USER CHAR(10) NOT NULL,
	TOTAL_REVENUE MONEY,
	STATUS_REVENUE BIT NOT NULL
)

CREATE TABLE REVENUE_DETAILS (
	RD_ORDINAL_NUM INT IDENTITY PRIMARY KEY,
	ID_GARA CHAR(10) NOT NULL,
	ID_REVENUE_REPORT CHAR(10) NOT NULL,
	ID_BRAND CHAR(10) NOT NULL,
	NUMBER_OF_REPAIRS INT NOT NULL,
	RATE FLOAT NOT NULL,
	TOTAL_MONEY MONEY,
	STATUS_RD BIT NOT NULL
)

/*
CREATE TABLE COST_CATEGORY (
	ID_COST_CATEGORY CHAR(10) PRIMARY KEY,
	NAME_COST_CATEGORY NVARCHAR(100) NOT NULL,
)


CREATE TABLE TOTAL_COSTS (
	ID_TOTAL_COSTS CHAR(10) PRIMARY KEY,
	RENDERING_TOTAL_COST SMALLDATETIME,
	RENDERING_STAFF CHAR(10) NOT NULL,
	TOTAL_PRICE MONEY,
)

CREATE TABLE TOTAL_COST_DETAILS (
	ID_TCD INT IDENTITY PRIMARY KEY,
	ID_TOTAL_COSTS CHAR(10) NOT NULL,
	ID_COST_CATEGORY CHAR(10) NOT NULL,
	TOTAL_PRICE MONEY
)

CREATE TABLE BUSINESS_SITUATION (
	BS_RENDER CHAR(10) PRIMARY KEY,
	BS_RENDER_DATE SMALLDATETIME NOT NULL,
	REVENUE MONEY NOT NULL,
	COST MONEY NOT NULL,
	PROFIT MONEY
) 
*/

GO

--- ADD FOREIGN KEY CONSTRAINT

--- STAFF POSITION
ALTER TABLE STAFF_POSITION ADD CONSTRAINT FK_SP_ID_GARA
FOREIGN KEY (ID_GARA) REFERENCES CAR_GARA(ID_GARA)

--- STAFFS
ALTER TABLE STAFFS ADD CONSTRAINT FK_STAFF_POSITION
FOREIGN KEY (ID_POSITION) REFERENCES STAFF_POSITION(ID_POS)
ALTER TABLE STAFFS ADD CONSTRAINT  FK_STAFF_ID_GARA
FOREIGN KEY (ID_GARA) REFERENCES CAR_GARA

--- CAR_BRANDS
ALTER TABLE CAR_BRANDS ADD CONSTRAINT FK_BRAND_ID_GARA
FOREIGN KEY (ID_GARA) REFERENCES CAR_GARA(ID_GARA)

-------RECEPTION_FORMS 
ALTER TABLE RECEPTION_FORMS ADD CONSTRAINT FK_RECEPTION_FORM_ID_CUS 
FOREIGN KEY (ID_REC) REFERENCES CUSTOMERS(ID_CUS)
ALTER TABLE RECEPTION_FORMS ADD CONSTRAINT FK_RECEPTION_FORMS_ID_BRAND
FOREIGN KEY (ID_BRAND) REFERENCES CAR_BRANDS(ID_BRAND)
ALTER TABLE RECEPTION_FORMS ADD CONSTRAINT FK_QUANTITY_CUS
FOREIGN KEY (RECEPTION_DATE) REFERENCES GARA_QUANTITY_RULES (RULE_DATE)
ALTER TABLE RECEPTION_FORMS ADD CONSTRAINT FK_REC_ID_CAR
FOREIGN KEY (ID_GARA) REFERENCES CAR_GARA(ID_GARA)

------- CAR_COMPONENTS
ALTER TABLE CAR_COMPONENTS ADD CONSTRAINT FK_CAR_COM_ID_GARA
FOREIGN KEY (ID_GARA) REFERENCES CAR_GARA(ID_GARA)

-------WAGE_COMPONENT 
ALTER TABLE WAGE_COMPONENT ADD CONSTRAINT FK_WAGE_COMPONENT_ID_COM
FOREIGN KEY (ID_COM) REFERENCES CAR_COMPONENTS(ID_COM)

-------GOOD_RECEIVED_NOTES
ALTER TABLE GOOD_RECEIVED_NOTES ADD CONSTRAINT FK_GOOD_RECEIVED_NOTES_CONFIRMER
FOREIGN KEY (CONFIRMER) REFERENCES STAFFS(ID_STAFF)
ALTER TABLE GOOD_RECEIVED_NOTES ADD CONSTRAINT FK_GOOD_RECEIVED_NOTES_USER
FOREIGN KEY (DATA_ENTRY_STAFF) REFERENCES ACCOUNTS(ID_ACC)
ALTER TABLE GOOD_RECEIVED_NOTES ADD CONSTRAINT FK_GOOD_RECEIVED_NOTES_ID_CAR
FOREIGN KEY (ID_GARA) REFERENCES CAR_GARA(ID_GARA)

-------GRN_DETAILS
ALTER TABLE GRN_DETAILS ADD CONSTRAINT FK_GRN_DETAILS_LOTNUMBER
FOREIGN KEY (LOTNUMBER) REFERENCES GOOD_RECEIVED_NOTES(LOTNUMBER)
ALTER TABLE GRN_DETAILS ADD CONSTRAINT FK_GRN_DETAILS_ID_COM
FOREIGN KEY (ID_COM) REFERENCES CAR_COMPONENTS(ID_COM)
ALTER TABLE GRN_DETAILS ADD CONSTRAINT FK_GRN_DETAILS_ID_OTHERCOM
FOREIGN KEY (ID_COM) REFERENCES OTHER_COSTS(ID_COST)

------REPAIR_PAYMENT_BILL
ALTER TABLE REPAIR_PAYMENT_BILL ADD CONSTRAINT FK_REPAIR_PAYMENT_BILL
FOREIGN KEY (ID_REC) REFERENCES RECEPTION_FORMS(ID_REC)

------ REPAIR_PAYMENT_DETAILS
ALTER TABLE REPAIR_PAYMENT_DETAILS ADD CONSTRAINT FK_REPAIR_PAYMENT_DETAILS_IDBILL
FOREIGN KEY (ID_BILL) REFERENCES REPAIR_PAYMENT_BILL(ID_BILL)
ALTER TABLE REPAIR_PAYMENT_DETAILS ADD CONSTRAINT FK_REPAIR_PAYMENT_DETAILS_IDCOM
FOREIGN KEY (ID_COM) REFERENCES CAR_COMPONENTS(ID_COM)

------INVENTORY_MANAGEMENT
ALTER TABLE INVENTORY_MANAGEMENT ADD CONSTRAINT FK_INVENTORY_MANAGEMENT_IDCOM
FOREIGN KEY (ID_COM) REFERENCES CAR_COMPONENTS(ID_COM)
ALTER TABLE INVENTORY_MANAGEMENT ADD CONSTRAINT FK_INVENTORY_MANAGEMENT_ID_GARA
FOREIGN KEY (ID_GARA) REFERENCES CAR_GARA (ID_GARA)

------BEGINING_INVENTORY
ALTER TABLE BEGINING_INVENTORY ADD CONSTRAINT FK_BEGINING_INVENTORY_IDCOM
FOREIGN KEY (ID_COM) REFERENCES CAR_COMPONENTS(ID_COM)
ALTER TABLE BEGINING_INVENTORY ADD CONSTRAINT FK_BEGINING_INVENTORY_ID_GARA
FOREIGN KEY (ID_GARA) REFERENCES CAR_GARA (ID_GARA)

-----ENDING_INVENTORY
ALTER TABLE ENDING_INVENTORY ADD CONSTRAINT FK_ENDING_INVENTORY_IDCOM
FOREIGN KEY (ID_COM) REFERENCES CAR_COMPONENTS(ID_COM)
ALTER TABLE ENDING_INVENTORY ADD CONSTRAINT FK_ENDING_INVENTORY_ID_GARA
FOREIGN KEY (ID_GARA) REFERENCES CAR_GARA (ID_GARA)

-----INCURRED_COSTS
ALTER TABLE INCURRED_COSTS ADD CONSTRAINT FK_INCURRED_COSTS_IDCOM
FOREIGN KEY (ID_COM) REFERENCES CAR_COMPONENTS(ID_COM)
ALTER TABLE INCURRED_COSTS ADD CONSTRAINT FK_INCURRED_COSTS_ID_GARA
FOREIGN KEY (ID_GARA) REFERENCES CAR_GARA (ID_GARA)

-----REVENUE
ALTER TABLE REVENUE ADD CONSTRAINT FK_REVENUE_ID_USER
FOREIGN KEY (ID_USER) REFERENCES ACCOUNTS(ID_ACC)
ALTER TABLE REVENUE ADD CONSTRAINT FK_REVENUE_ID_GARA
FOREIGN KEY (ID_GARA) REFERENCES CAR_GARA (ID_GARA)

-----REVENUE_DETAILS
ALTER TABLE REVENUE_DETAILS ADD CONSTRAINT FK_REVENUE_DETAILS_IDREVENUE
FOREIGN KEY (ID_REVENUE_REPORT) REFERENCES REVENUE(ID_REVENUE_REPORT)
ALTER TABLE REVENUE_DETAILS ADD CONSTRAINT FK_REVENUE_DETAILS_ID_COM
FOREIGN KEY (ID_BRAND) REFERENCES CAR_BRANDS(ID_BRAND)

/*
-----TOTAL COSTS
ALTER TABLE TOTAL_COSTS ADD CONSTRAINT FK_TOTAL_CONSTRAINT_IDTC
FOREIGN KEY (RENDERING_STAFF) REFERENCES ACCOUNTS(ID_ACC)

-----TOTAL_COST_DETAILS
ALTER TABLE TOTAL_COST_DETAILS ADD CONSTRAINT FK_TOTAL_COST_DETAILS_ID_TTC
FOREIGN KEY (ID_TOTAL_COSTS) REFERENCES TOTAL_COSTS(ID_TOTAL_COSTS)
ALTER TABLE TOTAL_COST_DETAILS ADD CONSTRAINT FK_ID_TOTAL_COSTS_COST_CAT
FOREIGN KEY (ID_COST_CATEGORY) REFERENCES COST_CATEGORY(ID_COST_CATEGORY)
*/
