IF DB_ID('CAR_GARAGE_MANAGEMENT') IS NOT NULL
USE CAR_GARAGE_MANAGEMENT

-- ADD FOREIGN KEY CONSTRAINT

-- STAFFS
ALTER TABLE STAFFS ADD CONSTRAINT FK_STAFF_POSITION
FOREIGN KEY (ID_POSITION) REFERENCES STAFF_POSITION(ID_POS)

ALTER TABLE STAFFS ADD CONSTRAINT  FK_STAFF_ID_GARA
FOREIGN KEY (ID_GARA) REFERENCES CAR_GARA

-- CUSTOMER_DETAILS
ALTER TABLE CUSTOMER_DETAILS ADD CONSTRAINT PK_CUSTOMER_DETAILS 
PRIMARY KEY (ID_CUS, ID_GARA)

ALTER TABLE CUSTOMER_DETAILS ADD CONSTRAINT FK_CUSTOMER_DETAILS_ID_CUS 
FOREIGN KEY (ID_CUS) REFERENCES CUSTOMERS(ID_CUS)

ALTER TABLE CUSTOMER_DETAILS ADD CONSTRAINT FK_CUSTOMER_DETAILS_ID_GARA
FOREIGN KEY (ID_GARA) REFERENCES CAR_GARA(ID_GARA)

-- RECEPTION_FORMS 
ALTER TABLE RECEPTION_FORMS ADD CONSTRAINT FK_RECEPTION_FORM_ID_CUS 
FOREIGN KEY (ID_CUS) REFERENCES CUSTOMERS(ID_CUS)

ALTER TABLE RECEPTION_FORMS ADD CONSTRAINT FK_RECEPTION_FORMS_ID_BRAND
FOREIGN KEY (ID_BRAND) REFERENCES CAR_BRANDS(ID_BRAND)

ALTER TABLE RECEPTION_FORMS ADD CONSTRAINT FK_REC_ID_CAR
FOREIGN KEY (ID_GARA) REFERENCES CAR_GARA(ID_GARA)

-- COMPONENT_DETAILS
ALTER TABLE COMPONENT_DETAILS ADD CONSTRAINT PK_COMPONENT_DETAILS
PRIMARY KEY (ID_COM, ID_GARA)

ALTER TABLE COMPONENT_DETAILS ADD CONSTRAINT FK_COMPONENT_DETAILS_ID_GARA
FOREIGN KEY (ID_GARA) REFERENCES CAR_GARA(ID_GARA)

ALTER TABLE COMPONENT_DETAILS ADD CONSTRAINT FK_COMPONENT_DETAILS_ID_COM
FOREIGN KEY (ID_COM) REFERENCES CAR_COMPONENTS(ID_COM)

-- BRAND_DETAILS
ALTER TABLE BRAND_DETAILS ADD CONSTRAINT PK_BRAND_DETAILS 
PRIMARY KEY (ID_BRAND, ID_GARA)

ALTER TABLE BRAND_DETAILS ADD CONSTRAINT FK_BRAND_DETAILS_ID_GARA
FOREIGN KEY (ID_GARA) REFERENCES CAR_GARA(ID_GARA)

ALTER TABLE BRAND_DETAILS ADD CONSTRAINT FK_BRAND_DETAILS_ID_BRAND
FOREIGN KEY (ID_BRAND) REFERENCES CAR_BRANDS(ID_BRAND)

-- GOOD_RECEIVED_NOTES
ALTER TABLE GOOD_RECEIVED_NOTES ADD CONSTRAINT FK_GOOD_RECEIVED_NOTES_USER
FOREIGN KEY (DATA_ENTRY_STAFF) REFERENCES ACCOUNTS(ID_ACC)

ALTER TABLE GOOD_RECEIVED_NOTES ADD CONSTRAINT FK_GOOD_RECEIVED_NOTES_ID_CAR
FOREIGN KEY (ID_GARA) REFERENCES CAR_GARA(ID_GARA)

ALTER TABLE GOOD_RECEIVED_NOTES ADD CONSTRAINT FK_GRN_SUPPLIER_GARA
FOREIGN KEY(SUPPLIER) REFERENCES SUPPLIERS(ID_SUPPLIER)

-- GRN_DETAILS
ALTER TABLE GRN_DETAILS ADD CONSTRAINT FK_GRN_DETAILS_LOTNUMBER
FOREIGN KEY (LOTNUMBER) REFERENCES GOOD_RECEIVED_NOTES(LOTNUMBER)

ALTER TABLE GRN_DETAILS ADD CONSTRAINT FK_GRN_DETAILS_ID_COM
FOREIGN KEY (ID_COM) REFERENCES CAR_COMPONENTS(ID_COM)

-- GARA_QUANTITY_RULE
ALTER TABLE GARA_QUANTITY_RULES ADD CONSTRAINT FK_QUANTITY_RULES_ID_GARA 
FOREIGN KEY (ID_GARA) REFERENCES CAR_GARA(ID_GARA)

-- REPAIR_PAYMENT_BILL
ALTER TABLE REPAIR_PAYMENT_BILL ADD CONSTRAINT FK_REPAIR_PAYMENT_BILL
FOREIGN KEY (ID_REC) REFERENCES RECEPTION_FORMS(ID_REC)

-- REPAIR_PAYMENT_DETAILS
ALTER TABLE REPAIR_PAYMENT_DETAILS ADD CONSTRAINT FK_REPAIR_PAYMENT_DETAILS_IDBILL
FOREIGN KEY (ID_BILL) REFERENCES REPAIR_PAYMENT_BILL(ID_BILL)

ALTER TABLE REPAIR_PAYMENT_DETAILS ADD CONSTRAINT FK_REPAIR_PAYMENT_DETAILS_IDCOM
FOREIGN KEY (ID_COM) REFERENCES CAR_COMPONENTS(ID_COM)

-- INVENTORY_MANAGEMENT
ALTER TABLE INVENTORY_MANAGEMENT ADD CONSTRAINT FK_INVENTORY_MANAGEMENT 
FOREIGN KEY (ID_GARA) REFERENCES CAR_GARA(ID_GARA)

-- BEGINING_INVENTORY
ALTER TABLE BEGINING_INVENTORY ADD CONSTRAINT FK_BEGINING_INVENTORY_ID_GARA
FOREIGN KEY (ID_GARA) REFERENCES CAR_GARA(ID_GARA)

-- ENDING_INVENTORY
ALTER TABLE ENDING_INVENTORY ADD CONSTRAINT FK_ENDING_INVENTORY_ID_GARA
FOREIGN KEY (ID_GARA) REFERENCES CAR_GARA(ID_GARA)

-- INCURRED_COSTS
ALTER TABLE INCURRED_COSTS ADD CONSTRAINT FK_INCURRED_COSTS_IDCOM
FOREIGN KEY (ID_COM) REFERENCES CAR_COMPONENTS(ID_COM)

ALTER TABLE INCURRED_COSTS ADD CONSTRAINT FK_INCURRED_COSTS_ID_GARA
FOREIGN KEY (ID_GARA) REFERENCES CAR_GARA (ID_GARA)

-- REVENUE
ALTER TABLE REVENUE ADD CONSTRAINT FK_REVENUE_ID_GARA
FOREIGN KEY (ID_GARA) REFERENCES CAR_GARA (ID_GARA)

-- REVENUE_DETAILS
ALTER TABLE REVENUE_DETAILS ADD CONSTRAINT FK_REVENUE_DETAILS_ID_COM
FOREIGN KEY (ID_BRAND) REFERENCES CAR_BRANDS(ID_BRAND)

ALTER TABLE REVENUE_DETAILS ADD CONSTRAINT FK_REVENUE_DETAILS_ID_GARA
FOREIGN KEY (ID_GARA) REFERENCES CAR_GARA(ID_GARA)


-- List all constraint of table
SELECT 
    C.CONSTRAINT_NAME AS ConstraintName,
    C.CONSTRAINT_TYPE AS ConstraintType,
    C.TABLE_NAME AS TableName,
    K.COLUMN_NAME AS ColumnName,
    K.ORDINAL_POSITION AS ColumnOrder
FROM 
    INFORMATION_SCHEMA.TABLE_CONSTRAINTS C
LEFT JOIN 
    INFORMATION_SCHEMA.KEY_COLUMN_USAGE K ON C.CONSTRAINT_NAME = K.CONSTRAINT_NAME
WHERE C.TABLE_NAME IS NOT NULL -- Replace with C.TABLE_NAME = [Table_name] to list constraint of specific table
ORDER BY 
    C.TABLE_NAME, C.CONSTRAINT_TYPE, C.CONSTRAINT_NAME, K.ORDINAL_POSITION;
