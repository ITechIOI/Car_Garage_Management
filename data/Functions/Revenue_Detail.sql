--Lấy thông tin chi tiêu của gara trong khoảng thời gian
CREATE OR ALTER PROCEDURE USP_GARA_SPEND_DETAILS
@ID_GARA CHAR(10), @START_DATE SMALLDATETIME, @END_DATE SMALLDATETIME
AS
BEGIN
	SELECT CC.NAME_COM AS [Vật tư], IC.INCURRED_COSTS_DATE AS [Ngày phát sinh], IC.STATUS_DESCRIPTION AS [Nội dung], CD.CUR_PRICE AS [Đơn giá], IC.COM_QUANTITY AS [Số lượng], IC.INCURRED_COSTS_TTPRICE AS [Chi phí]
	FROM INCURRED_COSTS IC, CAR_COMPONENTS CC, COMPONENT_DETAILS CD
	WHERE 
		IC.ID_COM = CC.ID_COM AND 
		CD.ID_COM = CC.ID_COM AND
		CD.ID_GARA = @ID_GARA AND
		IC.ID_GARA = @ID_GARA AND
		IC.INCURRED_COSTS_DATE >= @START_DATE AND
		IC.INCURRED_COSTS_DATE <= @END_DATE

	UNION

	SELECT CC.NAME_COM AS [Vật tư], GRN.IMPORT_TIME AS [Ngày phát sinh], N'Nhập hàng' AS [Nội dung], GD.COM_PRICE AS [Đơn giá], GD.COM_QUANTITY AS [Số lượng], GD.GRN_TOTAL_PAYMENT AS [Chi phí]
	FROM GOOD_RECEIVED_NOTES GRN, GRN_DETAILS GD, CAR_COMPONENTS CC 
	WHERE 
		GRN.LOTNUMBER = GD.LOTNUMBER AND
		GD.ID_COM = CC.ID_COM AND
		GRN.ID_GARA = @ID_GARA AND
		GRN.IMPORT_TIME >= @START_DATE AND
		GRN.IMPORT_TIME <= @END_DATE
	ORDER BY [Ngày phát sinh]
END
GO