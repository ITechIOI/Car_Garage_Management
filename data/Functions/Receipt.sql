CREATE TABLE RECEIPT
(
	ID_RECEIPT CHAR(10) NOT NULL,
	ID_CUS CHAR(10),
	ID_GARA CHAR(10),
	RECEIPT_DATE SMALLDATETIME,
	RECEIPT_STAFF CHAR(10),
    PROCEEDS MONEY
)

ALTER TABLE RECEIPT
ADD CONSTRAINT PK_RECEIPT PRIMARY KEY (ID_RECEIPT)

ALTER TABLE RECEIPT
ADD CONSTRAINT FK_RECEIPT_CUSTOMER FOREIGN KEY (ID_CUS) REFERENCES CUSTOMERS(ID_CUS)

ALTER TABLE RECEIPT
ADD CONSTRAINT FK_RECEIPT_GARA FOREIGN KEY (ID_GARA) REFERENCES CAR_GARA(ID_GARA)

ALTER TABLE RECEIPT
ADD CONSTRAINT FK_RECEIPT_STAFF FOREIGN KEY (RECEIPT_STAFF) REFERENCES STAFFS(ID_STAFF)

CREATE OR ALTER PROC USP_INSERTRECEIPT
@id CHAR(10), @idCus CHAR(10), @gara CHAR(10), @receiptDate VARCHAR(30), @staff CHAR(10), @proceeds MONEY
AS
BEGIN
	SET DATEFORMAT DMY
	DECLARE @receiptDate1 SMALLDATETIME
	SET @receiptDate1 = CAST(@receiptDate AS SMALLDATETIME)
	INSERT RECEIPT VALUES (@id, @idCus, @gara, @receiptDate1, @staff, @proceeds)
	SET @proceeds = -1 * @proceeds
	EXEC USP_UPDATEDEBTOFCUSTOMER @gara, @idCus,  @proceeds
END

SELECT * FROM RECEPTION_FORMS WHERE ID_GARA = '' AND STATUS_REC = 0