ALTER TABLE INVENTORY_MANAGEMENT
ADD CONSTRAINT FK_INVENTORY_COMPONENT FOREIGN KEY (ID_COM) REFERENCES CAR_COMPONENTS(ID_COM)

CREATE OR ALTER FUNCTION dbo.GET_MAX_LOTNUMBER()
RETURNS INT
AS
BEGIN
	DECLARE 
		@MAX_LOTNUMBER CHAR(10), 
		@MAX_NUM INT

	IF ((SELECT COUNT(*) FROM GOOD_RECEIVED_NOTES) = 0)
		RETURN 0

	SELECT TOP 1 @MAX_LOTNUMBER = LOTNUMBER
	FROM GOOD_RECEIVED_NOTES
	ORDER BY CAST(SUBSTRING(LOTNUMBER, 4, LEN(LOTNUMBER))AS INT) DESC;
	
	DECLARE @SUB_MAX CHAR(10) = SUBSTRING(@MAX_LOTNUMBER, 4, LEN(@MAX_LOTNUMBER))
	SET @MAX_NUM = CAST(@SUB_MAX AS INT)

	RETURN @MAX_NUM
END
GO

